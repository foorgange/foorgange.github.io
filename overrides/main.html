{% extends "base.html" %}

{% block extrahead %}
  <!-- 自定义头部内容 -->
  <meta name="description" content="snowfoootball的个人博客 - 探索技术的边界，记录生活的美好">
  <meta name="keywords" content="技术博客,编程,算法,文学,个人博客,snowfoootball">
  <meta name="author" content="snowfoootball">
  
  <!-- Open Graph 标签 -->
  <meta property="og:title" content="{{ config.site_name }}">
  <meta property="og:description" content="探索技术的边界，记录生活的美好">
  <meta property="og:type" content="website">
  <meta property="og:url" content="{{ config.site_url }}">
  
  <!-- 自定义字体 -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
  
  <!-- 自定义图标 -->
  <link rel="icon" type="image/svg+xml" href="{{ 'assets/images/favicon.svg' | url }}">
  
  <!-- 预加载关键资源 -->
  <link rel="preload" href="{{ 'assets/stylesheets/extra.css' | url }}" as="style">
  <link rel="preload" href="{{ 'assets/stylesheets/background.css' | url }}" as="style">
{% endblock %}

{% block scripts %}
  {{ super() }}
  
  <!-- 自定义JavaScript -->
  <script>
    // 页面加载完成后的初始化
    document.addEventListener('DOMContentLoaded', function() {
      // 添加页面加载动画
      document.body.classList.add('page-loaded');
      
      // 平滑滚动
      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
          e.preventDefault();
          const target = document.querySelector(this.getAttribute('href'));
          if (target) {
            target.scrollIntoView({
              behavior: 'smooth',
              block: 'start'
            });
          }
        });
      });
      
      // 代码块复制功能增强
      enhanceCodeBlocks();
      
      // 图片懒加载
      if ('IntersectionObserver' in window) {
        lazyLoadImages();
      }
    });
    
    // 增强代码块功能
    function enhanceCodeBlocks() {
      const codeBlocks = document.querySelectorAll('pre code');
      codeBlocks.forEach(block => {
        // 添加行号
        if (!block.classList.contains('no-line-numbers')) {
          addLineNumbers(block);
        }
        
        // 添加语言标签
        addLanguageLabel(block);
      });
    }
    
    // 添加行号
    function addLineNumbers(codeBlock) {
      const lines = codeBlock.textContent.split('\n');
      if (lines.length > 1) {
        const lineNumbers = lines.map((_, index) => 
          `<span class="line-number">${index + 1}</span>`
        ).join('');
        
        const lineNumbersDiv = document.createElement('div');
        lineNumbersDiv.className = 'line-numbers';
        lineNumbersDiv.innerHTML = lineNumbers;
        
        const pre = codeBlock.parentElement;
        pre.style.position = 'relative';
        pre.insertBefore(lineNumbersDiv, codeBlock);
      }
    }
    
    // 添加语言标签
    function addLanguageLabel(codeBlock) {
      const className = codeBlock.className;
      const languageMatch = className.match(/language-(\w+)/);
      
      if (languageMatch) {
        const language = languageMatch[1];
        const label = document.createElement('div');
        label.className = 'code-language-label';
        label.textContent = language.toUpperCase();
        
        const pre = codeBlock.parentElement;
        pre.style.position = 'relative';
        pre.appendChild(label);
      }
    }
    
    // 图片懒加载
    function lazyLoadImages() {
      const imageObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const img = entry.target;
            img.src = img.dataset.src;
            img.classList.remove('lazy');
            imageObserver.unobserve(img);
          }
        });
      });
      
      document.querySelectorAll('img[data-src]').forEach(img => {
        imageObserver.observe(img);
      });
    }
    
    // 主题切换动画
    const themeToggle = document.querySelector('[data-md-component="palette"]');
    if (themeToggle) {
      themeToggle.addEventListener('change', function() {
        document.body.style.transition = 'background-color 0.3s ease, color 0.3s ease';
        setTimeout(() => {
          document.body.style.transition = '';
        }, 300);
      });
    }
  </script>
  
  <!-- 页面性能监控 -->
  <script>
    // 简单的性能监控
    window.addEventListener('load', function() {
      if ('performance' in window) {
        const loadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
        console.log(`页面加载时间: ${loadTime}ms`);
        
        // 如果加载时间过长，显示提示
        if (loadTime > 3000) {
          console.warn('页面加载较慢，建议优化资源');
        }
      }
    });
  </script>
{% endblock %}

{% block styles %}
  {{ super() }}
  
  <!-- 页面加载动画样式 -->
  <style>
    body {
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    body.page-loaded {
      opacity: 1;
    }
    
    /* 代码块增强样式 */
    .line-numbers {
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 3em;
      background: rgba(0, 0, 0, 0.1);
      border-right: 1px solid rgba(255, 255, 255, 0.1);
      padding: 1.5rem 0.5rem;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.8em;
      line-height: 1.5;
      color: rgba(255, 255, 255, 0.5);
      user-select: none;
    }
    
    .line-number {
      display: block;
      text-align: right;
    }
    
    .code-language-label {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 0.2rem 0.5rem;
      border-radius: 3px;
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    /* 有行号的代码块需要左边距 */
    pre:has(.line-numbers) code {
      padding-left: 4em;
    }
    
    /* 图片懒加载样式 */
    img.lazy {
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    img:not(.lazy) {
      opacity: 1;
    }
    
    /* 滚动条美化 */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.1);
    }
    
    ::-webkit-scrollbar-thumb {
      background: linear-gradient(45deg, #667eea, #764ba2);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(45deg, #f093fb, #f5576c);
    }
  </style>
{% endblock %}